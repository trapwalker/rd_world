__cls__: Quest
doc    : Примеры квестов

first_state: begin
current_state: ~

caption: Смертельное проклятье
text: Каждое {kills_count} убийство влечет смерть самого игрока.

#    text_short = StringField(tags='client', caption=u'Короткий текст квеста', doc=u'Может строиться и меняться по шаблону')
#    typename = StringField(tags='client', caption=u'Тип квеста', doc=u'Может быть произвольным')
#    list_icon = StringField(tags='client', caption=u'Пиктограмма для списков', doc=u'Мальенькая картинка для отображения в списках')  # todo: use UrlField
#    level = IntField(tags='client', caption=u'Уровень квеста', doc=u'Обычно число, но подлежит обсуждению')  # todo: обсудить
#    starttime = DateTimeField(tags='client', caption=u'Начало выполнения', doc=u'Время старта квеста')
#    deadline = DateTimeField(tags='client', caption=u'Срок выполнения этапа', doc=u'datetime до провала текущего этапа. Может меняться')

#    hirer = UniReferenceField(tags='client', caption=u'Заказчик', doc=u'NPC-заказчик квеста')
#    town = UniReferenceField(tags='client', caption=u'Город выдачи', doc=u'Город выдачи квеста')
#    agent = UniReferenceField(tags='client', caption=u'Агент', doc=u'Исполнитель квеста')

states:
    - id: begin
      parent: reg:///registry/quest_states
      abstract: false

      status: active
      on_enter: |
        log("STATE({state.id}) ENTER ЖОПА {quest.caption}")

      on_exit: |
        log("STATE({state.id}) EXIT")

      on_event: |
        quest.current_count += 1
        log("STATE({state.id}) EVENT({event!r}): now {quest.current_count!r} kills")
        if quest.current_count >= quest.kills_count:
            log("  Well done! go to final")
            go('final')
        else:
            log("  That's not enough to finish. Need to {quest.kills_count}")


    - id: final
      parent: reg:///registry/quest_states/final
      abstract: false

      status: end
      result: win
      on_enter: |
        log("STATE({state.id}) ENTER")

      on_exit: |
        log("STATE({state.id}) EXIT !!!")

      on_event: |
        log("STATE({state.id}) EVENT({event!r}) !!!")


### специфические параметры ###

kills_count: ~
current_count: 0
kills_count_min: 2
kills_count_max: 10

