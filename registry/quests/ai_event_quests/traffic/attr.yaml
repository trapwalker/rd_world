__cls__: AITrafficQuest
_cls: AITrafficQuest
doc    : Квесты

cars:
  - reg:///registry/mobiles/cars/light/motorcycles/honda_hornet/quick_bot
  - reg:///registry/mobiles/cars/middle/sports/delorean_dmc12/quick_bot
  - reg:///registry/mobiles/cars/middle/cars/dodge_challenger/quick_bot
  - reg:///registry/mobiles/cars/middle/offroad/defender/quick_bot
  - reg:///registry/mobiles/cars/heavy/btrs/m113a1/quick_bot

first_state: begin
test_end_time: 15
generation_max_count: 3

on_generate: |
    pass

on_start: |
    quest.deploy_bots(event=event)
    log('on_start {!r}'.format(quest))

states:
    - id: begin
      parent: reg:///registry/quest_states/test/begin
      on_enter: |
          set_timer(name='test_end', delay=quest.test_end_time)
      on_event: |
          if isinstance(event, OnTimer) and (event.name == 'test_end'):
              status = quest.get_traffic_status(event)
              if status == 'win':
                  quest.displace_bots(event)
                  go('win')
              elif status == 'fail':
                  quest.displace_bots(event)
                  go('fail')
              else:
                  set_timer(name='test_end', delay=quest.test_end_time)

    - id: win
      parent: reg:///registry/quest_states/final/win

    - id: fail
      parent: reg:///registry/quest_states/final/fail
